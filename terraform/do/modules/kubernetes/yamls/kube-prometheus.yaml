# kube-prometheus Configuration - Variables Only (minimal, replica count = 1)
# All variables are injected via Terraform templatefile() in prometheus.tf
# Defaults ref: _kube-prometheus.yaml

## =========================
## Operator (image + resources)
## =========================
operator:
  image:
    registry: docker.io
    repository: bitnamilegacy/prometheus-operator
  resources:
    requests:
      cpu: ${kube_prometheus_operator_request_cpu}
      memory: ${kube_prometheus_operator_request_memory}
    limits:
      cpu: ${kube_prometheus_operator_limit_cpu}
      memory: ${kube_prometheus_operator_limit_memory}
  nodeSelector:
    "doks.digitalocean.com/node-pool": ${node_pool_label}

## =========================
## kube-prometheus Prometheus (replicaCount from TF, image, resources, storage)
## =========================
prometheus:
  replicaCount: ${kube_prometheus_replica_count}
  image:
    registry: docker.io
    repository: bitnamilegacy/prometheus
  resources:
    requests:
      cpu: ${kube_prometheus_request_cpu}
      memory: ${kube_prometheus_request_memory}
    limits:
      cpu: ${kube_prometheus_limit_cpu}
      memory: ${kube_prometheus_limit_memory}
  nodeSelector:
    "doks.digitalocean.com/node-pool": ${node_pool_label}
  persistence:
    enabled: true
    size: ${kube_prometheus_persistence_size}
  thanos:
    resources:
      requests:
        cpu: ${kube_prometheus_thanos_request_cpu}
        memory: ${kube_prometheus_thanos_request_memory}
      limits:
        cpu: ${kube_prometheus_thanos_limit_cpu}
        memory: ${kube_prometheus_thanos_limit_memory}
  ## Scrape Consul metrics (consul-exporter sidecar on consul-metrics:9107)
  additionalScrapeConfigs:
    enabled: ${consul_scrape_enabled}
    type: internal
    internal:
      jobList:
        - job_name: consul-exporter
          static_configs:
            - targets:
                - ${consul_exporter_target}
          metrics_path: ${consul_exporter_metrics_path}
          scrape_interval: ${consul_exporter_scrape_interval}
        - job_name: consul
          static_configs:
            - targets:
                - ${consul_target}
          metrics_path: ${consul_metrics_path}
          scrape_interval: ${consul_scrape_interval}
## =========================
## Alertmanager (replicaCount from TF, image, resources, storage)
## =========================
alertmanager:
  replicaCount: ${kube_prometheus_alertmanager_replica_count}
  image:
    registry: docker.io
    repository: bitnamilegacy/alertmanager
  resources:
    requests:
      cpu: ${kube_prometheus_alertmanager_request_cpu}
      memory: ${kube_prometheus_alertmanager_request_memory}
    limits:
      cpu: ${kube_prometheus_alertmanager_limit_cpu}
      memory: ${kube_prometheus_alertmanager_limit_memory}
  nodeSelector:
    "doks.digitalocean.com/node-pool": ${node_pool_label}
  persistence:
    enabled: true
    size: ${kube_prometheus_alertmanager_persistence_size}
## =========================
## Blackbox Exporter (replicaCount from TF, image, resources)
## =========================
blackboxExporter:
  enabled: false
  replicaCount: ${kube_prometheus_blackbox_exporter_replica_count}
  image:
    registry: docker.io
    repository: bitnamilegacy/blackbox-exporter
  resources:
    requests:
      cpu: ${kube_prometheus_blackbox_exporter_request_cpu}
      memory: ${kube_prometheus_blackbox_exporter_request_memory}
    limits:
      cpu: ${kube_prometheus_blackbox_exporter_limit_cpu}
      memory: ${kube_prometheus_blackbox_exporter_limit_memory}
  nodeSelector:
    "doks.digitalocean.com/node-pool": ${node_pool_label}

## =========================
## Thanos Ruler (replicaCount from TF, image, resources)
## =========================
thanosRuler:
  replicaCount: ${kube_prometheus_thanos_ruler_replica_count}
  image:
    registry: docker.io
    repository: bitnamilegacy/thanos
  resources:
    requests:
      cpu: ${kube_prometheus_thanos_ruler_request_cpu}
      memory: ${kube_prometheus_thanos_ruler_request_memory}
    limits:
      cpu: ${kube_prometheus_thanos_ruler_limit_cpu}
      memory: ${kube_prometheus_thanos_ruler_limit_memory}
  nodeSelector:
    "doks.digitalocean.com/node-pool": ${node_pool_label}

## =========================
## Exporters (disabled for minimal footprint)
## =========================
exporters:
  node-exporter:
    enabled: false
  kube-state-metrics:
    enabled: false
